# Tokens

Api base implements `hook_tokens()`, and with `helfi_api_base.token_manager` a `TokenEvent` is fired for each token. This allows other modules to implement token handling in an event subscribers that are easy to test and offer easy way to manipulate event handling priority.

Modules should still implement `hook_tokens_info` to provide information about the implemented tokens.


## Defining token subsciber

Add a new event subscriber:

```yml
# yourmodule/yourmodule.services.yml
  yourmodule.your_token_subscriber:
    class: Drupal\yourmodule\EventSubscriber\YourTokenSubscriber
    arguments: []
    tags:
      - { name: event_subscriber }
```

```php
# yourmodule/src/EventSubscriber/YourTokenSubscriber.php
<?php

declare(strict_types=1);

namespace Drupal\yourmodule\EventSubscriber;

use Drupal\helfi_api_base\Event\TokenEvent;
use Symfony\Component\EventDispatcher\EventSubscriberInterface;

/**
 * Handles token hooks.
 */
final class YourTokenSubscriber implements EventSubscriberInterface {

  /**
   * Responds to token event.
   *
   * @param \Symfony\Contracts\EventDispatcher\Event $event
   *   The event.
   */
  public function handleTokens(TokenEvent $event) : void {
    if ($event->token === 'foobar') {
      // Provide replacement value with
      // `setReplacementValue` method.
      $event->setReplacementValue('foobar');
    }
  }

  /**
   * {@inheritdoc}
   */
  public static function getSubscribedEvents(): array {
    return [
      // Handlers with lower priority are executed
      // after this handler, and they may choose to
      // overwrite any value generated by this class.
      TokenEvent::class => ['handleTokens', 100]
    ];
  }

}
```
